# AI开发助手规范指南

## 项目架构概览

基于NestJS + MikroORM + Redis的现代化后端架构，采用模块化设计，包含完整的异常处理、日志记录、API测试等规范。

## 核心规范

### 1. API测试规范

- **工具**: 使用httpyac进行接口测试
- **文件**: 所有测试用例集中在`api-test.http`
- **命名**: 采用`模块.操作.状态`格式（如`book.create`、`user.login.success`）
- **运行**: `pnpm yac -n <api-name>`
- **变量**: 支持环境变量、随机变量、自定义变量

### 2. 异常处理机制

- **三层过滤器链**:
  1. ValidationFilter - 数据验证异常
  2. HttpFilter - HTTP异常
  3. DefaultFilter - 兜底异常处理
- **响应格式**: `{code, msg, logId?, detail?}`
- **最佳实践**: 使用NestJS内置HTTP异常，避免直接抛Error

### 3. 日志记录标准

- **日志级别**: TRACE → DEBUG → LOG → WARN → ERROR → FATAL
- **使用方式**: 每个类创建私有Logger实例
- **格式要求**: 清晰描述操作和结果，包含关键上下文
- **敏感信息**: 严禁记录密码等敏感数据
- **异常日志**: 必须包含完整的错误信息和堆栈

### 4. 版本管理原则

- **强制精确版本**: 所有依赖必须使用精确版本号
- **禁止**: ^、~、*、latest等版本范围前缀
- **目的**: 确保项目稳定性和可重现性

### 5. Entity实体规范

- **位置**: 所有Entity实体必须生成在`db`模块的`entities`目录下
- **路径**: `src/global/db/entities/`
- **命名**: 采用`[name].entity.ts`格式（如`user.entity.ts`、`book.entity.ts`）
- **继承**: 所有Entity必须继承自`EntityBase`基类

## 开发最佳实践

### 任务执行原则

- **任务优先**: 当任务没有完成时，专注于核心逻辑实现，不要修复格式错误问题
- **格式优化**: 任务完成后确保逻辑正确，再进行格式问题的修复和优化
- **逻辑验证**: 优先保证功能正确性和业务逻辑完整性

### 控制器层

- 记录请求开始、结束和关键参数
- 包含traceId用于链路追踪

### 服务层

- 记录业务逻辑关键步骤
- 区分不同场景（成功、失败、异常）

### 数据访问层

- 记录数据库操作的开始和完成
- 避免记录敏感字段

## 接口测试

1. 查看现有API测试示例：`api-test.http`
2. 在 `api-test.http` 中新增功能API记录
3. 测试验证：`pnpm yac -n <api-name>`

## 文档编写规范

### 文件结构

- **格式**: 采用Markdown格式，保持层级清晰

### 内容标准

- **格式**: 采用Markdown格式，保持层级清晰
- **代码示例**: 使用代码块并标明语言类型，如 ```typescript

### 编写原则

- **简洁明了**: 避免冗余描述，直接阐述核心要点
- **示例驱动**: 通过具体代码示例说明规范要求，不要使用系统中的具体代码，使用你理解之后的Demo代码
- **最佳实践**: 明确标注推荐做法和需要避免的做法
- **文件引用**: 不要引用项目中的任何文件
- **可操作性**: 提供具体的命令和配置示例
